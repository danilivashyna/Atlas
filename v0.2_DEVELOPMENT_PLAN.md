# SPDX-License-Identifier: AGPL-3.0-or-later
# Copyright (c) 2025 Danil Ivashyna

# v0.2 Development Checklist - GitHub Issues

Этот документ содержит список GitHub issues для v0.2 разработки.
Каждый issue соответствует одному PR и одному компоненту плана.

## 📋 Структура

Каждый issue должен содержать:
- **Description**: Что нужно сделать
- **Acceptance Criteria**: Когда issue считается выполненным
- **Related Files**: Какие файлы затрагиваются
- **Labels**: `type: enhancement`, `version: v0.2`, `status: ready`

---

## 🎯 Issues для v0.2 (в порядке приоритета)

### Issue 1: Neural Encoder (BERT-based) - src/atlas/models/encoder_bert.py

**Title:** `feat: Implement BERT-based 5D encoder for v0.2`

**Description:**
Implement TextEncoder5D class that uses Hugging Face sentence-transformers to encode text into 5D semantic space.

**Acceptance Criteria:**
- [ ] TextEncoder5D class fully implemented
- [ ] Handles empty input with ValueError
- [ ] Projects from hidden_dim -> 5D with optional orthogonality
- [ ] L2 normalization working
- [ ] Values clamped to [-1, 1]
- [ ] Unit tests pass (>80% coverage)
- [ ] Can encode Russian and English text
- [ ] Latency <500ms on CPU (p95)

**Related Files:**
- `src/atlas/models/encoder_bert.py` (NEW)
- `src/atlas/models/__init__.py` (NEW)
- `tests/test_encoder_bert.py` (NEW)

**Labels:** `type: enhancement`, `version: v0.2`, `component: models`, `priority: high`

---

### Issue 2: Interpretable Decoder (Transformer-based) - src/atlas/models/decoder_transformer.py

**Title:** `feat: Implement Transformer-based interpretable decoder for v0.2`

**Description:**
Implement InterpretableDecoder that conditions on 5D vectors and generates text with interpretable reasoning.
For MVP (v0.2), generate reasoning but not full text (text generation in v0.3).

**Acceptance Criteria:**
- [ ] InterpretableDecoder class implemented
- [ ] Forward pass: (B,5) + (B,T) -> (B,T,vocab_size)
- [ ] Positional embeddings working
- [ ] Condition projection working
- [ ] decode() method returns reasoning for all 5 dimensions
- [ ] Temperature and top_k parameters functional
- [ ] Unit tests pass
- [ ] Explanation includes dimension labels and strengths

**Related Files:**
- `src/atlas/models/decoder_transformer.py` (NEW)
- `tests/test_decoder_transformer.py` (NEW)

**Labels:** `type: enhancement`, `version: v0.2`, `component: models`, `priority: high`

---

### Issue 3: Hierarchical Losses - src/atlas/models/losses_hier.py

**Title:** `feat: Implement hierarchical regularization losses`

**Description:**
Implement ortho_loss, l1_sparsity, router_entropy for training hierarchical encoders.

**Acceptance Criteria:**
- [ ] ortho_loss: ||W^T W - I||_F implemented
- [ ] l1_sparsity: mean(|x|) implemented
- [ ] router_entropy: -mean(sum(p*log(p))) implemented
- [ ] cosine_loss implemented
- [ ] hierarchical_regularization combines all losses
- [ ] All functions handle edge cases (empty tensors, NaN, etc.)
- [ ] Unit tests with torch tensors
- [ ] Documentation with formulas

**Related Files:**
- `src/atlas/models/losses_hier.py` (NEW)
- `tests/test_losses_hier.py` (NEW)

**Labels:** `type: enhancement`, `version: v0.2`, `component: training`, `priority: high`

---

### Issue 4: Hierarchical Metrics - src/atlas/metrics/metrics_hier.py

**Title:** `feat: Add hierarchical metrics (stubs for v0.2.1+ implementation)`

**Description:**
Add stub implementations for H-Coherence and H-Stability metrics. Full implementations in v0.2.1+.

**Acceptance Criteria:**
- [ ] h_coherence_stub returns CoherenceResult with score 0..1
- [ ] h_stability_stub returns StabilityResult with score 0..1
- [ ] Stub returns 0.5 (neutral) for MVP
- [ ] Documentation includes TODO for full implementations
- [ ] interpretability_metrics_summary works with both metrics
- [ ] Tests verify stub behavior
- [ ] Includes NPMI/ARI implementation roadmap

**Related Files:**
- `src/atlas/metrics/metrics_hier.py` (NEW)
- `src/atlas/metrics/__init__.py` (NEW)
- `tests/test_metrics_hier.py` (NEW)

**Labels:** `type: enhancement`, `version: v0.2`, `component: metrics`, `priority: medium`

---

### Issue 5: Knowledge Distillation - src/atlas/training/distill.py

**Title:** `feat: Implement knowledge distillation from teacher models`

**Description:**
Implement distill_loss for training student (5D hierarchical) on teacher (1536D) embeddings.

**Acceptance Criteria:**
- [ ] distill_loss: cosine similarity based
- [ ] kl_distill_loss: KL divergence variant
- [ ] combined_distill_loss: alpha-weighted combination
- [ ] Handles normalization correctly
- [ ] Tests with torch tensors
- [ ] Documentation includes usage examples
- [ ] Config constants for typical settings

**Related Files:**
- `src/atlas/training/distill.py` (NEW)
- `src/atlas/training/__init__.py` (NEW)
- `tests/test_distill.py` (NEW)

**Labels:** `type: enhancement`, `version: v0.2`, `component: training`, `priority: medium`

---

### Issue 6: REST API Endpoints for Hierarchy

**Title:** `feat: Add /encode_h, /decode_h, /manipulate_h endpoints`

**Description:**
Extend FastAPI with hierarchical endpoints. (Note: Endpoints already exist in current API, this documents them)

**Acceptance Criteria:**
- [ ] POST /encode_h works with EncodeHierarchicalRequest
- [ ] POST /decode_h works with DecodeHierarchicalRequest
- [ ] POST /manipulate_h works with ManipulateHierarchicalRequest
- [ ] Response schemas validated (Pydantic models)
- [ ] Error handling for invalid inputs
- [ ] Trace IDs for logging
- [ ] API docs at /docs complete
- [ ] Integration tests with curl/REST client

**Related Files:**
- `src/atlas/api/app.py` (EXISTING - verify implementation)
- `src/atlas/api/models.py` (UPDATE if needed)
- `tests/test_api_hierarchical.py` (NEW)

**Labels:** `type: enhancement`, `version: v0.2`, `component: api`, `priority: high`

---

### Issue 7: VS Code Development Setup

**Title:** `docs: Add local development setup guide for v0.2`

**Description:**
Provide comprehensive local setup instructions for developers using VS Code.

**Acceptance Criteria:**
- [ ] DEVELOPMENT_LOCAL_SETUP.md created
- [ ] Quick start (5 min) section complete
- [ ] Virtual environment setup instructions
- [ ] VS Code launch.json with debug configs
- [ ] Makefile with all useful commands
- [ ] Troubleshooting section
- [ ] curl/REST Client examples

**Related Files:**
- `DEVELOPMENT_LOCAL_SETUP.md` (NEW)
- `.vscode/launch.json` (NEW)
- `.vscode/settings.json` (NEW)
- `Makefile` (NEW)

**Labels:** `type: documentation`, `version: v0.2`, `component: dev`, `priority: high`

---

### Issue 8: Licensing Documentation

**Title:** `docs: Add dual-licensing documentation (AGPL + Commercial)`

**Description:**
Document AGPL-3.0-or-later and commercial licensing options.

**Acceptance Criteria:**
- [ ] docs/LICENSING.md explains both licenses
- [ ] Commercial license template provided
- [ ] FAQ covers common scenarios
- [ ] CLA.md updated/clarified
- [ ] SPDX headers documented
- [ ] Contact info for commercial inquiries

**Related Files:**
- `docs/LICENSING.md` (NEW)
- `CLA.md` (UPDATE)
- `LICENSE` (VERIFY - AGPL text)

**Labels:** `type: documentation`, `version: v0.2`, `component: legal`, `priority: medium`

---

### Issue 9: Benchmark Script

**Title:** `feat: Add performance benchmarking for hierarchical operations`

**Description:**
Implement benchmark script for p50/p95 latency, memory usage.

**Acceptance Criteria:**
- [ ] Hierarchical encode/decode benchmarks
- [ ] p50/p95 latency reported
- [ ] Memory profiling included
- [ ] Results saved to JSON
- [ ] Can filter by operation type
- [ ] Runs on CPU (optional CUDA)
- [ ] Documentation in scripts/README

**Related Files:**
- `scripts/benchmark_hierarchical.py` (EXISTING - verify implementation)
- `scripts/benchmark_v0.2.py` (NEW if needed)

**Labels:** `type: enhancement`, `version: v0.2`, `component: benchmarks`, `priority: medium`

---

### Issue 10: Test Coverage (Encoder, Decoder, Losses, Metrics)

**Title:** `test: Achieve >80% test coverage for v0.2 components`

**Description:**
Add comprehensive unit and integration tests for all v0.2 components.

**Acceptance Criteria:**
- [ ] test_encoder_bert.py: >80% coverage
- [ ] test_decoder_transformer.py: >80% coverage
- [ ] test_losses_hier.py: >80% coverage
- [ ] test_metrics_hier.py: >80% coverage
- [ ] test_distill.py: >80% coverage
- [ ] test_api_hierarchical.py: >80% coverage
- [ ] All edge cases covered
- [ ] Golden samples tests pass
- [ ] pytest --cov shows >80% overall

**Related Files:**
- `tests/test_*.py` (MULTIPLE NEW)

**Labels:** `type: testing`, `version: v0.2`, `component: tests`, `priority: high`

---

### Issue 11: CLI Commands for Hierarchical Operations

**Title:** `feat: Add CLI commands for hierarchical encode/decode/manipulate`

**Description:**
Extend atlas CLI with -h variants for hierarchical operations.

**Acceptance Criteria:**
- [ ] `atlas encode-h` command works
- [ ] `atlas decode-h` command works
- [ ] `atlas manipulate-h` command works
- [ ] Help text complete and clear
- [ ] Examples provided
- [ ] JSON input/output supported
- [ ] Integration tests with subprocess

**Related Files:**
- `src/atlas/cli.py` (EXISTING - verify/extend)
- `tests/test_cli_hierarchical.py` (NEW)

**Labels:** `type: enhancement`, `version: v0.2`, `component: cli`, `priority: medium`

---

### Issue 12: Documentation Update - Hierarchical Space

**Title:** `docs: Update HIERARCHICAL_SPACE.md for v0.2 neural implementation`

**Description:**
Update hierarchical space documentation with v0.2 neural components.

**Acceptance Criteria:**
- [ ] Neural encoder section added
- [ ] Transformer decoder section added
- [ ] Training & loss functions documented
- [ ] Metrics roadmap clarified
- [ ] API examples updated
- [ ] CLI examples added
- [ ] Migration guide from v0.1 to v0.2

**Related Files:**
- `docs/HIERARCHICAL_SPACE.md` (UPDATE)

**Labels:** `type: documentation`, `version: v0.2`, `component: docs`, `priority: medium`

---

## 📊 Priority Matrix

| Priority | Issues | Completion Order |
|----------|--------|-----------------|
| **HIGH** | 1, 2, 6, 7, 10 | Do first |
| **MEDIUM** | 4, 5, 8, 9, 11 | Do second |
| **LOW** | 3, 12 | Do last |

## 🔄 Workflow per Issue

1. **Create Issue** on GitHub with template above
2. **Create Branch**: `git checkout -b issue/N-short-name`
3. **Implement Feature**: Code + tests
4. **Submit PR**: Link to issue, request review
5. **CI Passes**: Run tests, lint, coverage
6. **Merge**: Squash or rebase
7. **Close Issue**: Auto-close on merge or manually

## 📝 PR Template

```markdown
## Issue
Closes #N

## Changes
- Implemented ...
- Added tests for ...
- Updated docs ...

## Testing
- [ ] Unit tests pass
- [ ] Integration tests pass
- [ ] Coverage >80%
- [ ] Linting passes

## Checklist
- [ ] SPDX header added
- [ ] Docstrings added
- [ ] Examples provided
- [ ] Backwards compatible
```

---

**Last Updated**: 2025-01-19
**Status**: Ready for development
**Estimated Timeline**: 2-4 weeks (all 12 issues)
