# Beam Loop v0.6.0: Iterative Routing

## Overview

Beam Loop implements iterative routing with beam search, allowing progressive refinement of routing results through multiple iterations with confidence-based stopping.

## Features

### Iterative Routing
- Beam search with configurable width
- Confidence threshold stopping
- Depth-limited expansion
- ANN integration for candidate generation

### Configuration
Environment variables:
- `ATLAS_ROUTER_BEAM`: Beam width (default: 5)
- `ATLAS_ROUTER_DEPTH`: Max iterations (default: 2)
- `ATLAS_ROUTER_CONF`: Confidence threshold (default: 0.85)
- `ATLAS_ROUTER_K_MULT`: ANN multiplier (default: 3.0)

### API Endpoint

#### POST /router/route_iter
Perform iterative routing.
```json
{
  "text": "cats and dogs",
  "top_k": 10,
  "beam": null,  // Uses autoscale if null
  "depth": null,
  "conf": null
}
```
Response:
```json
{
  "path": "dim2/dim2.4",
  "confidence": 0.92,
  "iterations": 2
}
```

## Algorithm

1. Start with root candidates from ANN
2. Expand beam with child nodes
3. Score candidates by semantic similarity
4. Select top-k via softmax
5. Repeat until confidence threshold or max depth
6. Return best path

## Metrics

- `router_beam_iterations_total`: Routing iterations
- `router_beam_confidence`: Confidence histogram
- `router_beam_time_ms`: Latency histogram

## Logging

Debug logs include:
- Beam size per iteration
- Confidence progression
- Final path selection
