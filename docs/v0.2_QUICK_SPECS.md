# v0.2 Developer Quick Specs

> **Печать эту шпаргалку на стол рядом с монитором** 📋
> **Версия**: 2025-10-20
> **Для**: PRs #7-12 (API, Losses, Distill, Metrics, Benchmarks, Docs/CLI)

---

## 🎯 Copy-Paste for Your Agent

### PR #7 — API (encode_h, decode_h, explain_h)
```
Repository: danilivashyna/Atlas
Branch: feature/v0.2-03-api-hier-ops
Goal: add POST /encode_h, /decode_h, /explain_h with Pydantic v2 models; update OpenAPI.
Deliverables: endpoints in app.py, models.py; smoke tests; docs.
Acceptance: pytest -q green; /docs shows 3 routes; responses include trace_id + UTC timestamp.
```

### PR #8 — Losses (Orthogonality, Sparsity, Entropy)
```
Repository: danilivashyna/Atlas
Branch: feature/v0.2-04-losses-hier
Goal: implement Orthogonality, Sparsity(L1), RouterEntropy losses.
Deliverables: losses.py + tests + docs.
Acceptance: numeric tests pass; no NaN/Inf; pytest -q green.
```

### PR #9 — Distill (Teacher→Student)
```
Repository: danilivashyna/Atlas
Branch: feature/v0.2-05-distill-teacher
Goal: distillation scaffold with CLI; offline friendly.
Deliverables: distill.py, configs.py, tools/train_distill.py, docs, smoke test.
Acceptance: dry-run steps on CPU; pytest -q green; CLI --help works.
```

### PR #10 — Metrics (H-Coherence, H-Stability, H-Diversity)
```
Repository: danilivashyna/Atlas
Branch: feature/v0.2-06-metrics-hier
Goal: implement H-Coherence, H-Stability, H-Diversity.
Deliverables: metrics_hier.py + tests + docs.
Acceptance: deterministic examples; values in valid ranges; pytest -q green.
```

### PR #11 — Benchmarks (pytest-benchmark)
```
Repository: danilivashyna/Atlas
Branch: feature/v0.2-07-benchmarks
Goal: add pytest-benchmark scenarios; skip if pkg missing.
Deliverables: test_bench_encoder.py, test_bench_decoder.py, docs.
Acceptance: tests run/skip cleanly; no flakes.
```

### PR #12 — Docs/CLI (atlas_cli.py)
```
Repository: danilivashyna/Atlas
Branch: feature/v0.2-08-docs-demos-cli
Goal: update docs and add atlas_cli.py (encode/decode/explain).
Deliverables: CLI + docs + smoke test.
Acceptance: CLI works offline; pytest -q green.
```

---

## ⚡ Before Push (Copy This)

```bash
# 1. Format
python -m pip install black isort
black .
isort .

# 2. Test
pytest -q

# 3. Check warnings
pytest -q 2>&1 | grep -i warning
# ↑ Should be empty

# 4. Commit + Push
git add .
git commit -m "feat(v0.2-0X): [Feature] implementation"
git push origin feature/v0.2-0X-*
```

---

## 🧪 Quick Test Commands

| Command | What It Does |
|---------|-------------|
| `pytest -q` | Run all tests (quick) |
| `pytest -q -k "encode_h"` | Run only tests with "encode_h" |
| `pytest tests/test_api_smoke.py -v` | Verbose output for one file |
| `pytest -x` | Stop on first failure |
| `pytest -s` | Show print output |
| `pytest --tb=short` | Short error traceback |

---

## 🌐 API Testing (PR #7)

```bash
# Terminal 1: Start API
uvicorn src.atlas.api.app:app --port 8010 &

# Terminal 2: Test
curl -s http://127.0.0.1:8010/encode_h \
  -X POST \
  -H "Content-Type: application/json" \
  -d '{"text":"hello"}'

# Expected:
# {"embedding": [1,0.5,-0.3,0.2,-0.1], "trace_id": "...", "timestamp": "...Z"}
```

---

## 📐 Loss Formulas (PR #8)

```
Orthogonality:  ||W^T W - I||_F^2 / (5^2)
Sparsity:       mean(|embeddings|)
Entropy:        -sum(p * log(p + eps))
```

---

## 🎓 Distill CLI (PR #9)

```bash
python tools/train_distill.py --help
python tools/train_distill.py --epochs 1 --batch-size 2 --output-dir ./test
```

---

## 📊 Metrics Output (PR #10)

```python
coherence(embeddings)  # → 0-1 (0 = random, 1 = perfect alignment)
stability(embeddings)  # → 0-1 (0 = unstable, 1 = stable)
diversity(embeddings)  # → 0-1 (0 = collapsed, 1 = diverse)
```

---

## 📈 Benchmarks (PR #11)

```bash
# Without pytest-benchmark: skipped ✓
pytest tests/benchmarks/ -q

# With pytest-benchmark:
pip install pytest-benchmark
pytest tests/benchmarks/ -q
```

---

## 💻 CLI Usage (PR #12)

```bash
python tools/atlas_cli.py encode "hello world"
python tools/atlas_cli.py decode "[1,0.5,-0.3,0.2,-0.1]"
python tools/atlas_cli.py explain "[1,0.5,-0.3,0.2,-0.1]"
```

---

## ✅ Definition of Done (Each PR)

- [ ] Code written following brief
- [ ] All tests pass: `pytest -q`
- [ ] No new warnings: `pytest 2>&1 | grep warning` (empty)
- [ ] Black formatted: `black . && isort .`
- [ ] Offline friendly (no downloads in tests)
- [ ] Timestamps in UTC (when applicable)
- [ ] Pydantic v2 ConfigDict (when applicable)
- [ ] Git: `git push origin feature/v0.2-0X-*`

---

## 🚀 After Implementation

```bash
# 1. Convert from draft
gh pr ready 7 --repo danilivashyna/Atlas

# 2. Add labels
gh pr edit 7 --repo danilivashyna/Atlas --add-label "v0.2"

# 3. Request review
gh pr edit 7 --repo danilivashyna/Atlas --add-reviewer danilivashyna

# 4. View it
gh pr view 7 --repo danilivashyna/Atlas --web
```

---

## 📌 Files Checklist

### PR #7 (API)
- [ ] `src/atlas/api/app.py` — 3 routes added
- [ ] `src/atlas/api/models.py` — Pydantic models
- [ ] `tests/test_api_smoke.py` — smoke tests
- [ ] `docs/HIERARCHICAL_API.md` — examples

### PR #8 (Losses)
- [ ] `src/atlas/training/losses.py` — 3 loss classes
- [ ] `tests/test_losses.py` — numerical tests
- [ ] `docs/LOSS_FUNCTIONS_v0.2.md` — formulas

### PR #9 (Distill)
- [ ] `src/atlas/training/distill.py` — Distiller class
- [ ] `src/atlas/training/configs.py` — DistillerConfig
- [ ] `tools/train_distill.py` — CLI
- [ ] `tests/test_distill_smoke.py` — dry-run tests
- [ ] `docs/distillation_quickstart.md` — guide

### PR #10 (Metrics)
- [ ] `src/atlas/metrics/metrics_hier.py` — 3 metrics
- [ ] `tests/test_metrics_hier.py` — tests
- [ ] `docs/METRICS_v0.2.md` — formulas

### PR #11 (Benchmarks)
- [ ] `tests/benchmarks/test_bench_encoder.py` — encoder benchmarks
- [ ] `tests/benchmarks/test_bench_decoder.py` — decoder benchmarks
- [ ] `docs/BENCHMARKS.md` — how to run

### PR #12 (Docs/CLI)
- [ ] `tools/atlas_cli.py` — CLI commands
- [ ] `README.md` — updated with v0.2
- [ ] `docs/QUICK_REFERENCE.md` — examples
- [ ] `tests/test_cli_smoke.py` — smoke tests

---

## 🆘 Troubleshooting

| Problem | Solution |
|---------|----------|
| `pytest: command not found` | `pip install pytest` |
| `pytest -q` fails | Run `pytest -v` for details |
| Black format fails | `pip install black isort` |
| API won't start | Check port 8010 not in use: `lsof -i :8010` |
| Tests download models | Mock them! No downloads allowed |
| Import error | Check `__init__.py` exports; run `pip install -e .` |

---

## 📞 Getting Help

1. **Check brief**: docs/v0.2_IMPLEMENTATION_SPECS.md (this file is shorter, that one is detailed)
2. **Check existing code**: Look at v0.2-01 or v0.2-02 skeleton for patterns
3. **Comment in PR**: GitHub notifies maintainer
4. **Read error**: 90% of errors are self-explanatory
5. **Google/ChatGPT**: For generic Python questions

---

**Print me! 🖨️ Keep by your desk. Reference often. Good luck! 💪**
