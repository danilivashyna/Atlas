# Atlas β — Разбивка на задачи (Issues)

Этот документ содержит структурированный список всех задач для релиза Atlas β.
Каждая задача соответствует эпику из TZ_ATLAS_BETA.md

---

## E1. API & Контракты

### E1.1 Создать Pydantic-схемы для всех эндпоинтов

**Описание:**
Реализовать Pydantic-модели для всех REST-эндпоинтов:
- `EncodeRequest`, `EncodeResponse`
- `DecodeRequest`, `DecodeResponse`
- `ExplainRequest`, `ExplainResponse`
- `EncodeHierarchicalRequest`, `EncodeHierarchicalResponse`
- `DecodeHierarchicalRequest`, `DecodeHierarchicalResponse`
- `ManipulateHierarchicalRequest`, `ManipulateHierarchicalResponse`
- `SearchRequest`, `SearchResponse`

**Файлы:**
- `src/atlas/api/schemas.py` (новый)

**Критерии приёмки:**
- [ ] Все схемы валидны и содержат примеры (docstring)
- [ ] JSON-сериализация работает корректно
- [ ] Тесты 100% покрытия для валидации

**Трудозатраты:** 4-6 часов

---

### E1.2 Реализовать `/encode` эндпоинт

**Описание:**
FastAPI маршрут для кодирования текста в 5D пространство.

**Файлы:**
- `src/atlas/api/routes/encode.py` (новый)
- `src/atlas/api/__init__.py` (обновить импорты)

**Критерии приёмки:**
- [ ] GET `http://localhost:8010/encode` с JSON-телом работает
- [ ] Response содержит `embedding_5d`, `dimensions`, `meta`
- [ ] Обработка ошибок (400, 422) корректна
- [ ] Трассировка trace_id логируется

**Трудозатраты:** 3-4 часа

---

### E1.3 Реализовать `/decode` эндпоинт

**Описание:**
Декодирование 5D вектора в текст с обоснованием.

**Файлы:**
- `src/atlas/api/routes/decode.py` (новый)

**Критерии приёмки:**
- [ ] POST возвращает текст + rationale
- [ ] path трассировка есть
- [ ] Валидация входа (embedding_5d должен быть [5])

**Трудозатраты:** 3-4 часа

---

### E1.4 Реализовать `/explain` эндпоинт

**Описание:**
Объяснение, какие измерения и как влияют на смысл вектора.

**Файлы:**
- `src/atlas/api/routes/explain.py` (новый)

**Критерии приёмки:**
- [ ] Response содержит dimensions с weights и examples
- [ ] Примеры релевантны оси

**Трудозатраты:** 2-3 часа

---

### E1.5 Реализовать `/encode_h` эндпоинт (иерархическое кодирование)

**Описание:**
Кодирование текста с выделением разных уровней иерархии.

**Файлы:**
- `src/atlas/api/routes/encode_h.py` (новый)

**Критерии приёмки:**
- [ ] Возвращает вложенные уровни и маски
- [ ] Маски token_to_sent, sent_to_para, para_to_doc корректны
- [ ] proj_dim параметр учитывается

**Трудозатраты:** 4-5 часов

---

### E1.6 Реализовать `/decode_h` эндпоинт

**Описание:**
Декодирование иерархических векторов обратно в текст.

**Файлы:**
- `src/atlas/api/routes/decode_h.py` (новый)

**Критерии приёмки:**
- [ ] Возвращает reconstructions на каждом уровне
- [ ] path_scores наполнены

**Трудозатраты:** 4-5 часов

---

### E1.7 Реализовать `/manipulate_h` эндпоинт

**Описание:**
Операции над иерархическими векторами (union, intersect, exclude, route).

**Файлы:**
- `src/atlas/api/routes/manipulate_h.py` (новый)

**Критерии приёмки:**
- [ ] Все ops работают
- [ ] Трассировка trace содержит шаги нормализации
- [ ] Тесты для каждой op

**Трудозатраты:** 6-8 часов

---

### E1.8 Реализовать `/search` эндпоинт с FAB-маршрутизацией

**Описание:**
Главный эндпоинт поиска. Fan-out по индексам (sent/para/doc), нормализация, RRF/max_sim слияние.

**Файлы:**
- `src/atlas/api/routes/search.py` (новый)
- `src/atlas/fab/router.py` (новый)
- `src/atlas/fab/merger.py` (новый)

**Критерии приёмки:**
- [ ] Поддержка RRF и max_sim фьюжена
- [ ] Per-level результаты в debug
- [ ] Трассировка ранков
- [ ] Latency p50 ≤ 60 ms (GPU) / ≤ 200 ms (CPU) на top_k=7
- [ ] Тесты с разными конфигами

**Трудозатраты:** 8-10 часов

---

### E1.9 Реализовать `/health`, `/ready`, `/metrics` эндпоинты

**Описание:**
Обслуживающие эндпоинты: liveness, readiness, Prometheus метрики.

**Файлы:**
- `src/atlas/api/routes/health.py` (новый)
- `src/atlas/metrics.py` (новый)

**Критерии приёмки:**
- [ ] `/health` возвращает 200 OK
- [ ] `/ready` проверяет индексы и MANIFEST
- [ ] `/metrics` в формате Prometheus
- [ ] Включены: atlas_api_requests_total, atlas_search_latency_ms, atlas_hits_at_k

**Трудозатраты:** 4-5 часов

---

### E1.10 Интеграционные тесты для API

**Описание:**
Smoke-тесты для всех эндпоинтов, проверка схем, обработка ошибок.

**Файлы:**
- `tests/test_api_beta.py` (новый)

**Критерии приёмки:**
- [ ] Все эндпоинты протестированы
- [ ] 4xx/5xx тесты есть
- [ ] Latency benchmarks задокументированы

**Трудозатраты:** 6-8 часов

---

## E2. Индексы & MANIFEST

### E2.1 Реализовать построение HNSW индексов (sentence/paragraph)

**Описание:**
Инструменты для построения HNSW индексов с параметрами:
- sentence: M=32, efConstruction=200, efSearch=64
- paragraph: M=48, efConstruction=400, efSearch=96

**Файлы:**
- `src/atlas/indices/hnsw_builder.py` (новый)

**Критерии приёмки:**
- [ ] Индексы построены с корректными параметрами
- [ ] L2-нормализация векторов
- [ ] Сохранение в `.hnsw` формат
- [ ] Скорость построения задокументирована

**Трудозатраты:** 4-5 часов

---

### E2.2 Реализовать построение FAISS индекса (document)

**Описание:**
Инструменты для построения FAISS IVF-PQ индекса:
- nlist ≈ √N
- m=16, nbits=8

**Файлы:**
- `src/atlas/indices/faiss_builder.py` (новый)

**Критерии приёмки:**
- [ ] Индекс построен с корректными параметрами
- [ ] L2-нормализация
- [ ] Сохранение в `.faiss` формат
- [ ] Тестирование на разных размерах N

**Трудозатраты:** 4-5 часов

---

### E2.3 Реализовать загрузку индексов и кэширование

**Описание:**
Менеджер для загрузки и управления жизненным циклом индексов в памяти.

**Файлы:**
- `src/atlas/indices/manager.py` (новый)

**Критерии приёмки:**
- [ ] Холодный старт < 5 s для ≤ 5M векторов
- [ ] Кэширование работает
- [ ] Memory footprint задокументирован

**Трудозатраты:** 4-5 часов

---

### E2.4 Реализовать MANIFEST генератор и валидатор

**Описание:**
Создание и проверка MANIFEST.v0_2.json:
- SHA256 хэши файлов
- Версионирование
- Совместимость vector_dim

**Файлы:**
- `src/atlas/manifest/generator.py` (новый)
- `src/atlas/manifest/validator.py` (новый)

**Критерии приёмки:**
- [ ] MANIFEST генерируется корректно
- [ ] SHA256 сверка работает
- [ ] Валидация vector_dim проходит
- [ ] Тесты на несовместимость

**Трудозатраты:** 4-5 часов

---

### E2.5 Реализовать атомарное переключение индексов (active/next)

**Описание:**
Двойной путь (active/next) для безопасного обновления индексов.

**Файлы:**
- `src/atlas/indices/switcher.py` (новый)

**Критерии приёмки:**
- [ ] Переключение atomic
- [ ] No downtime при апдейте
- [ ] Роллбек возможен
- [ ] Тесты на concurrency

**Трудозатраты:** 5-6 часов

---

### E2.6 Интеграционные тесты для индексов

**Описание:**
Тесты построения, загрузки, переключения, роллбека.

**Файлы:**
- `tests/test_indices_beta.py` (новый)

**Критерии приёмки:**
- [ ] Full lifecycle тестирование
- [ ] Performance benchmarks
- [ ] Manifest валидация

**Трудозатраты:** 5-6 часов

---

## E3. Метрики памяти

### E3.1 Реализовать H-Coherence метрику

**Описание:**
Средний косинус между соседними уровнями иерархии.

**Файлы:**
- `src/atlas/metrics/h_coherence.py` (новый)

**Критерии приёмки:**
- [ ] Метрика ≥ 0.78 (sent/para), ≥ 0.80 (para/doc)
- [ ] Алгоритм задокументирован
- [ ] Тесты с синтетическими данными

**Трудозатраты:** 3-4 часа

---

### E3.2 Реализовать H-Stability метрику

**Описание:**
Дрейф эмбеддингов при пертурбациях (пунктуация, шум).

**Файлы:**
- `src/atlas/metrics/h_stability.py` (новый)

**Критерии приёмки:**
- [ ] Drift ≤ 0.08
- [ ] Пертурбации включают пунктуацию, case-changes, noise
- [ ] Тесты на естественных текстах

**Трудозатраты:** 3-4 часа

---

### E3.3 Реализовать IR метрики (Recall@k, nDCG@k)

**Описание:**
Информационный поиск метрики для локальных наборов.

**Файлы:**
- `src/atlas/metrics/ir_metrics.py` (новый)

**Критерии приёмки:**
- [ ] Recall@k реализован
- [ ] nDCG@k реализован
- [ ] Baseline задокументирован

**Трудозатраты:** 3-4 часа

---

### E3.4 Создать тестовые наборы для метрик

**Описание:**
Синтетические и реальные наборы для валидации H-Coherence, H-Stability, IR.

**Файлы:**
- `samples/metrics_test_set.json` (новый)

**Критерии приёмки:**
- [ ] ≥ 100 примеров на уровень иерархии
- [ ] Пертурбированные варианты
- [ ] Gold standard разметка

**Трудозатраты:** 4-5 часов

---

### E3.5 Реализовать Prometheus метрики для памяти

**Описание:**
Экспорт H-Coherence, H-Stability, IR в Prometheus.

**Файлы:**
- `src/atlas/metrics/prometheus_exporter.py` (новый)

**Критерии приёмки:**
- [ ] Метрики экспортируются в `/metrics`
- [ ] Grafana дешборд можно создать
- [ ] Алерты настраиваются

**Трудозатраты:** 3-4 часа

---

### E3.6 Создать отчёт о метриках памяти

**Описание:**
Документ с результатами H-Coherence, H-Stability, IR на текущем наборе.

**Файлы:**
- `docs/METRICS_REPORT_BETA.md` (новый)

**Критерии приёмки:**
- [ ] Все целевые метрики достигнуты
- [ ] Таблицы результатов
- [ ] Выводы

**Трудозатраты:** 2-3 часа

---

## E4. НФТ (Non-Functional Requirements)

### E4.1 Реализовать логирование с trace_id и query_id

**Описание:**
Структурированное логирование для трассировки запросов.

**Файлы:**
- `src/atlas/logging.py` (новый)

**Критерии приёмки:**
- [ ] ATLAS_LOG_LEVEL (DEBUG|INFO) работает
- [ ] trace_id генерируется для каждого запроса
- [ ] query_id для поиска задан
- [ ] Логи структурированы (JSON-format опционально)

**Трудозатраты:** 3-4 часа

---

### E4.2 Реализовать базовые rate-limits

**Описание:**
Защита от перегрузки: ограничение QPS и размера payload.

**Файлы:**
- `src/atlas/api/middleware/rate_limit.py` (новый)

**Критерии приёмки:**
- [ ] Rate-limit по клиенту (IP) настраивается
- [ ] Возвращает 429 при превышении
- [ ] Configuration в env-переменных

**Трудозатраты:** 2-3 часа

---

### E4.3 Реализовать базовые алерты

**Описание:**
Alert-система для ошибок, latency spike'ов, индекс-проблем.

**Файлы:**
- `src/atlas/alerts.py` (новый)

**Критерии приёмки:**
- [ ] Алерты при > 5% error rate
- [ ] Алерты при p95 > 300 ms
- [ ] Индекс не загружен алерт

**Трудозатраты:** 3-4 часа

---

### E4.4 Профилирование cold-start

**Описание:**
Измерение времени загрузки индексов с холодного старта.

**Файлы:**
- `scripts/benchmark_cold_start.py` (новый)

**Критерии приёмки:**
- [ ] `/ready` < 5 s на ≤ 5M векторов
- [ ] Отчёт с breakdown (load time per index)
- [ ] CPU/Memory profile

**Трудозатраты:** 3-4 часа

---

### E4.5 Профилирование warm-paths (search latency)

**Описание:**
Бенчмарк `/search` на горячих путях.

**Файлы:**
- `scripts/benchmark_search_latency.py` (новый)

**Критерии приёмки:**
- [ ] p50 ≤ 60 ms (GPU) / ≤ 200 ms (CPU)
- [ ] p95 задокументирован
- [ ] Flame graph за бедностью

**Трудозатраты:** 4-5 часов

---

### E4.6 Создать profiling дашборд

**Описание:**
Инструмент для continuous monitoring production latency.

**Файлы:**
- `scripts/profiling_dashboard.py` (новый)

**Критерии приёмки:**
- [ ] Real-time метрики
- [ ] Historical тренды
- [ ] Alert thresholds

**Трудозатраты:** 4-5 часов

---

## E5. Документация

### E5.1 Обновить MODEL_CARD

**Описание:**
Описание модели, параметров, ограничений.

**Файлы:**
- `docs/MODEL_CARD.md` (обновить)

**Критерии приёмки:**
- [ ] Архитектура описана
- [ ] Параметры S1 (если есть)
- [ ] Limitations чётко обозначены

**Трудозатраты:** 2-3 часа

---

### E5.2 Обновить DATA_CARD

**Описание:**
Описание данных обучения, test set'ов, bias analysis.

**Файлы:**
- `docs/DATA_CARD.md` (обновить)

**Критерии приёмки:**
- [ ] Источники данных обучения
- [ ] Test set description
- [ ] Known biases

**Трудозатраты:** 2-3 часа

---

### E5.3 Обновить NFR документ

**Описание:**
Non-Functional Requirements с метриками приёмки.

**Файлы:**
- `docs/NFR.md` (обновить)

**Критерии приёмки:**
- [ ] Performance targets
- [ ] Reliability SLA
- [ ] Security requirements

**Трудозатраты:** 2-3 часа

---

### E5.4 Обновить INTERPRETABILITY документ

**Описание:**
Объяснимость: H-Coherence, path traces, примеры.

**Файлы:**
- `docs/INTERPRETABILITY_METRICS.md` (обновить)

**Критерии приёмки:**
- [ ] H-Coherence объяснен
- [ ] Path trace examples
- [ ] Limitations

**Трудозатраты:** 2-3 часа

---

### E5.5 Обновить DISENTANGLEMENT документ

**Описание:**
Дизентанглмент 5D измерений.

**Файлы:**
- `docs/DISENTANGLEMENT.md` (обновить)

**Критерии приёмки:**
- [ ] Определение дизентанглмента для Atlas
- [ ] Метрики оценки
- [ ] Результаты

**Трудозатраты:** 2-3 часа

---

### E5.6 Обновить README (Quick Start β)

**Описание:**
Раздел для быстрого старта с бета-версией.

**Файлы:**
- `README.md` (обновить)

**Критерии приёмки:**
- [ ] Installation instructions
- [ ] Quick example `/search`
- [ ] Docker run команда
- [ ] Links to docs

**Трудозатраты:** 2-3 часа

---

### E5.7 Создать API docs (OpenAPI/Swagger)

**Описание:**
Автоматическая документация всех эндпоинтов.

**Файлы:**
- `src/atlas/api/openapi.py` (новый)
- Доступ через `/docs` (FastAPI auto)

**Критерии приёмки:**
- [ ] Swagger UI доступна на `/docs`
- [ ] Все эндпоинты задокументированы
- [ ] Examples работают

**Трудозатраты:** 2-3 часа

---

## E6. (Опция) Нейронный S1

### E6.1 Загрузить encoder_base.mxfp16

**Описание:**
Подключить teacher-модель (если доступна).

**Файлы:**
- `src/atlas/models/encoder_loader.py` (новый)

**Критерии приёмки:**
- [ ] Модель загружается
- [ ] Inference работает
- [ ] Performance acceptable

**Трудозатраты:** 3-4 часа

---

### E6.2 Валидировать нормировки и совместимость

**Описание:**
Проверка нормировок, совместимость proj_dim.

**Файлы:**
- `src/atlas/models/validator.py` (новый)

**Критерии приёмки:**
- [ ] Нормировки проверяются
- [ ] proj_384/768 совместимость
- [ ] Unit тесты

**Трудозатраты:** 2-3 часа

---

### E6.3 Интеграция S1 в `/encode_h`

**Описание:**
Опциональное использование S1 для иерархического кодирования.

**Файлы:**
- `src/atlas/api/routes/encode_h.py` (обновить)

**Критерии приёмки:**
- [ ] Flag `use_s1` в request
- [ ] Fallback на rule-based если S1 недоступна
- [ ] Тесты

**Трудозатраты:** 3-4 часа

---

## E7. Релизные артефакты

### E7.1 Собрать индексы и MANIFEST

**Описание:**
Финальный build: `indexes/*.hnsw|*.faiss`, `MANIFEST.v0_2.json`.

**Файлы:**
- `scripts/build_release.py` (новый)

**Критерии приёмки:**
- [ ] Индексы собраны
- [ ] MANIFEST генерирован и валиден
- [ ] Все checksums корректны

**Трудозатраты:** 2-3 часа

---

### E7.2 Создать Dockerfile для β

**Описание:**
Docker образ для хостинга Atlas β.

**Файлы:**
- `Dockerfile.beta` (новый)

**Критерии приёмки:**
- [ ] Image builds успешно
- [ ] Все зависимости включены
- [ ] Volume mounting для индексов

**Трудозатраты:** 2-3 часа

---

### E7.3 Smoke-тесты для релиза

**Описание:**
Финальная проверка перед тегированием.

**Файлы:**
- `scripts/smoke_tests_beta.py` (новый)

**Критерии приёмки:**
- [ ] Все API эндпоинты работают
- [ ] Индексы загружены
- [ ] Метрики собираются
- [ ] 0 ошибок

**Трудозатраты:** 2-3 часа

---

### E7.4 Создать release notes для v0.2.0-beta

**Описание:**
Документирование основных фич, улучшений, known issues.

**Файлы:**
- `docs/RELEASE_NOTES_v0.2.0-beta.md` (новый)

**Критерии приёмки:**
- [ ] Основные фичи перечислены
- [ ] Performance improvements
- [ ] Known issues и workarounds
- [ ] Upgrade guide

**Трудозатраты:** 2-3 часа

---

### E7.5 Создать tag и publish release

**Описание:**
Финальный шаг: создание `v0.2.0-beta` тага, публикация на GitHub Releases.

**Файлы:**
- Git tag `v0.2.0-beta`
- GitHub Release

**Критерии приёмки:**
- [ ] Тег создан
- [ ] Release опубликован
- [ ] Архивы (tar, zip) доступны
- [ ] Docker image pushed

**Трудозатраты:** 1-2 часа

---

## Итого

| Эпик | Задачи | Часов | Недель |
|------|--------|-------|--------|
| E1 | 10 | 50-60 | 3-4 |
| E2 | 6 | 25-31 | 2 |
| E3 | 6 | 19-23 | 1.5 |
| E4 | 6 | 19-23 | 1.5 |
| E5 | 7 | 16-21 | 1.5 |
| E6 | 3 | 8-11 | 0.5 |
| E7 | 5 | 9-11 | 0.5 |
| **ИТОГО** | **43** | **146-180** | **10-12** |

**Рекомендация:** Параллельная работа на E2-E5 может сократить timeline до 6-7 недель.

---

## История

| Дата | Версия | Автор | Изменения |
|------|--------|-------|-----------|
| 27.10.2025 | 1.0 | Team | Первая версия разбивки задач |
